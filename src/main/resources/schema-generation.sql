CREATE OR REPLACE VIEW SHOWING_VIEW AS SELECT ROW_NUMBER() OVER () as ID, TRUNCATE (s.begin_time)  AS SDATE , S.CINEMA_ID, S.MOVIE_ID,  sum(t.price) AS box, count (T.id) as amount, CASE WHEN HOUR(s.begin_time) >=9 AND  HOUR( s.begin_time) <12 THEN 0  WHEN HOUR(s.begin_time) >=12 AND  HOUR( s.begin_time) <18 THEN  1  WHEN HOUR(s.begin_time) >=18 AND  HOUR( s.begin_time) <=23 THEN 2 ELSE 3 END AS s_type from showing s LEFT JOIN ticket t on s.id = t.showing_id GROUP BY S.CINEMA_ID, S.MOVIE_ID, S_TYPE,  TRUNCATE (s.begin_time),s.begin_time    HAVING count (T.id) >0;